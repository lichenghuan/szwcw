$define(["wgt_util", "jquery.adFocus", "jquery.easyZoom", "jquery.dialogMgr", "jquery.qrcode", "jquery.fileDownload", "wgt_readyload", "md5", "jquery.confirm", "jquery.message", "jquery.mediaQuery", "bootstrap"], function($, $0, $1, $2, $3, $4, $5, r, $6, $7, $8, $9, $10) {
    var glp = this._params,
        moqNum = 0,
        stockNum, tipMoqNum, tipStockNum, ajxaQueryFun = function(t, i, e, a, s, n) {
            var o = {};
            o.request_url = e, o.url_param = a, o.requst_type = s, "true" == i.isMock && (o.url_param.isMock = "true");
            var d = encodeURIComponent(encodeURIComponent(JSON.stringify(o))),
                r = $.md5Sign(JSON.stringify(o));
            $.ajax({
                type: "POST",
                url: "/comp/portalRouter",
                data: {
                    sign: r,
                    param: d
                },
                success: function(t) {
                    n(t)
                },
                error: function() {}
            })
        },
        getFileData = function(t, i, e, a, s, n) {
            $.ajax({
                type: s,
                url: e,
                data: a,
                success: function(t) {
                    n(t)
                },
                error: function() {}
            })
        };

    function isEmpty(t) {
        return t == undefined || null == t || 0 == t.length
    }

    function getIframeParam(t, i, e, a) {
        return {
            id: i.id,
            cls: i.styleId,
            scp: t,
            htmlType: "singleRow",
            dialogSrc: a || "",
            popupName: e.popupName,
            dialogWidth: e.popupWidth,
            dialogHeight: e.popupHeight,
            dialogEsStyle: i.es_PopupWindow,
            closeEsStyle: i.es_CloseBtn,
            shadeEsStyle: i.es_shade,
            popupAnimationEffect: e.animationEffect,
            popupAnimationTimeLong: e.animationTimeLong,
            popupState: e.popupState
        }
    }

    function linkSkipFun(t, i, e, a) {
        "_popup" == e ? a && t.data(a).show({
            dialogSrc: i
        }) : "_blank" == e ? $.openNewWindow(i) : $.openHref(i), $._UTL.stopEvent(event)
    }

    function getHDCutResult(isHD, isCut) {
        var result = "normal";
        return eval(isHD) && (result = "hd"), eval(isCut) && (result = "cut"), eval(isHD) && eval(isCut) && (result = "both"), result
    }

    function productImageHandle(params) {
        var compId = "c_" + params.id + "-imgjs",
            images_HDCut = getHDCutResult(params.images_isHD, params.images_isCut),
            ThumbnailBox_HDCut = getHDCutResult(params.ThumbnailBox_isHD, params.ThumbnailBox_isCut),
            tag_HDCut = getHDCutResult(params.TagBox_isHD, params.TagBox_isCut),
            _imgJson = setNewVideoImgJson(params),
            nav_type = "block";
        $.mediaQuery({
            callback768: function() {
                nav_type = "s"
            }
        });
        var _opts = {
            data: _imgJson,
            containerCls: "",
            comp_type: "productZoom",
            has_video: !0,
            comp_w_size: params.imageWidth,
            comp_h_size: params.imageHeight,
            box_img_style_0: "e_box",
            box_img_style_2: "p_images",
            e_img_style_0: "e_image",
            e_img_style_2: "p_image",
            e_a_img_style_0: "e_link",
            e_a_img_style_2: "p_linkB",
            e_a_txt_style_0: "e_link",
            e_a_txt_style_2: "p_linkA",
            box_nav_style_0: "e_box",
            box_nav_style_2: "p_ThumbnailBox",
            e_nav_img_style_0: "e_relationimg",
            e_nav_img_style_2: "p_ProRelationImg",
            e_nav_arrow_l_style_0: "e_switchbtn",
            e_nav_arrow_l_style_2: "p_SwitchBtnC",
            e_nav_arrow_r_style_0: "e_switchbtn",
            e_nav_arrow_r_style_2: "p_SwitchBtnD",
            box_tag_style_0: "e_box",
            box_tag_style_2: "p_TagBox",
            e_img_tag_style_0: "e_image",
            e_img_tag_style_2: "p_tag",
            img_tag_display: eval(params.TagBox),
            img_tag_display_type: tag_HDCut,
            img_scale_x: null,
            img_scale_y: null,
            img_w_size: params.imageWidth,
            img_h_size: params.imageHeight,
            img_display_type: images_HDCut,
            img_autoPlay: !0,
            img_autoPlayDuration: 5,
            img_transition: "fade",
            img_speed: 1e3,
            img_easing: "easeOutQuart",
            nav_display_status: eval(params.ThumbnailBox),
            nav_type: nav_type,
            nav_scale_x: parseInt(params.ThumbnailBox_defWidth) || 4,
            nav_scale_y: parseInt(params.ThumbnailBox_defHeight) || 3,
            nav_s_size_w: 20,
            nav_s_size_h: 20,
            nav_display_num: parseInt(params.ThumbnailBox_column) || 6,
            nav_position: "center",
            nav_display_padding: 10,
            nav_keyboardOnAlways: !0,
            nav_step: 1,
            nav_hover: !0,
            txt_display_status: !1,
            nav_img_display_type: ThumbnailBox_HDCut
        };

        function cssSet(t) {
            t.toggleClass("item_hide")
        }

        function navPosition(t) {
            0 < $("." + compId).find(".e_atlasbox-001").length ? $("." + compId).children().children().eq(3).css("text-align", t) : $("." + compId).children().children().eq(2).css("text-align", t)
        }
        $("." + compId).data("adFocus", null), $("." + compId).empty(), $("." + compId).adFocus(_opts), params.easy_Zoom && $("." + compId + " a.zoom").each(function() {
            $(this).easyZoom({
                zoomId: "." + compId
            })
        }), $("." + compId).dblclick(function(t) {
            return $(".panel").toggleClass("item_hide"), !1
        }), $("body").delegate(".btn-switch", "click", function(t) {
            var i, e = $(this).attr("data-elem");
            return $(this).toggleClass("on"), "j-title" === e && (i = !!$(this).hasClass("on"), _opts.txt_title = i), "j-describe" === e && (i = !!$(this).hasClass("on"), _opts.txt_describe = i), "j-pageNum" === e && (i = !!$(this).hasClass("on"), _opts.img_display_pageNum = i), "j-galary-txt" === e && (i = !!$(this).hasClass("on"), _opts.nav_galary_txt_display = i), elm = "e_switchbtn" === e ? (i = !!$(this).hasClass("on"), _opts.img_arrows = i, $("." + compId).find(".p_box-01").find("." + e)) : $("." + compId).find("." + e), cssSet(elm), $("." + compId).adFocus(_opts, !0), !1
        }), $(".addon-btn").on("click", function() {
            var t, i = $(this),
                e = i.parent().find("select").val(),
                a = i.attr("data-elem");
            ("j-animate" === a && (_opts.img_transition = e), "j-display-galary" === a && (_opts.nav_display_galary = "true" == e), "j-displayNum" === a && (_opts.nav_display_num = e), "j-imgSize" === a) && (0 < e.indexOf("X") && (t = e.split("X"), _opts.img_w_size = t[0], _opts.img_h_size = t[1], _opts.img_scale_x = "", _opts.img_scale_y = ""), 0 < e.indexOf(":") && (t = e.split(":"), _opts.img_scale_x = t[0], _opts.img_scale_y = t[1], _opts.img_w_size = "", _opts.img_h_size = ""));
            ("j-padding" === a && (_opts.nav_display_padding = e), "j-nav-galary-size" === a) && (0 < e.indexOf(":") && (t = e.split(":"), _opts.nav_galary_scale_x = t[0], _opts.nav_galary_scale_y = t[1]));
            return $("." + compId).adFocus(_opts), !1
        }), $(".example").find(".btn").on("click", function() {
            var t = $(this),
                i = t.attr("data-elem");
            return t.addClass("blue").siblings().removeClass("blue"), _opts.nav_position = i, $("." + compId).adFocus(_opts, !0), navPosition(i), !1
        })
    }

    function setPosition() {
        r.setCompPostion(), r.lazyImg({
            defObj: "body"
        })
    }

    function setTab(t, i) {
        var e = t.TabDecTab,
            a = t.TabSpecTab;
        e || (1 != e && 1 == a ? (i.find("#contentPage").removeClass("active"), i.find("#paramPage").addClass("active"), i.find("#paramDiv").removeClass("hide")) : 1 != e && 1 != a && (i.find("#contentPage").removeClass("active"), i.find("#paramPage").removeClass("active"), i.find(".TabHead").eq(0).addClass("active"), i.find(".TabCont").eq(0).removeClass("hide")))
    }

    function getImgSrc(t) {
        var e = new Array;
        return t && 0 < t.length && $(t).each(function(t, i) {
            e[t] = $(i).attr("data-src").substring(17, 39)
        }), e
    }

    function ShotVRBtn(t) {
        t.find(".p_show360").unbind("click").bind("click", function() {
            t.find(".d_masker-wp").removeClass("hide")
        }), t.find(".d_Close").unbind("click").bind("click", function() {
            t.find(".d_masker-wp").addClass("hide")
        }), t.find("#turntable").putPhotoDiv(2)
    }
    var detaiJson = null;

    function PruductskuDetail(a, n) {
        if (!a.find("#product-skuDetail") && "" == a.find("#product-skuDetail").val()) return !1;
        var t = a.find("#product-skuDetail").val();
        if (0 < a.find("#product-skuDetail").length && "" != t && (detaiJson = $.parseJSON(a.find("#product-skuDetail").val())), detaiJson && detaiJson.specConfs) var i = detaiJson.specConfs;
        var o = "",
            d = "",
            r = !1;
        detaiJson && detaiJson.specs && ($.each(detaiJson.specs, function(t, i) {
            o += '<div style="margin-bottom:10px;">', r = !0;
            for (var e = 0; e < i.productSpecValues.length; e++)
                for (var a = 0; a < detaiJson.specConfs.length; a++)
                    if (detaiJson.specConfs[a].specValueId == i.productSpecValues[e].id) {
                        d = "";
                        for (var s = 0; s < detaiJson.skus[0].productSkuSpecs.length; s++)
                            if (detaiJson.specConfs[a].specValueId == detaiJson.skus[0].productSkuSpecs[s].specValueId) {
                                d = "active";
                                break
                            }
                        r && (r = !1, o = o + i.name + "："), i.productSpecValues[e].imagePath ? ("/" == i.productSpecValues[e].imagePath.substr(0, 1) && (i.productSpecValues[e].imagePath = i.productSpecValues[e].imagePath.slice(1)), "true" == n.productsA ? o += "<div data-specId=" + i.productSpecValues[e].specId + ' class="e_box e_ProductBox-001 p_Product product ' + d + '" data-id=' + i.productSpecValues[e].id + "><div data-specId=" + i.productSpecValues[e].specId + ' class="e_box e_box-000 p_images picture higher" style="padding-bottom: 100%; height: 0px;"><div class="e_image e_image-000 p_image visible"><img src="' + (detaiJson.specConfs[a].productSpecImgList[0] ? detaiJson.specConfs[a].productSpecImgList[0].imagePath : i.productSpecValues[e].imagePath) + '" title="' + detaiJson.specConfs[a].alias + '" alt="' + detaiJson.specConfs[a].alias + '" putphotocls="higher"></div></div></div>' : o += "<div data-specId=" + i.productSpecValues[e].specId + ' class="e_box e_ProductBox-001 p_Product product ' + d + '" data-id=' + i.productSpecValues[e].id + "><div data-specId=" + i.productSpecValues[e].specId + ' class="e_box e_box-000 p_images picture higher" style="padding-bottom: 100%; height: 0px;"><div class="e_image e_image-000 p_image visible"><img src="/' + i.productSpecValues[e].imagePath + '" title="' + detaiJson.specConfs[a].alias + '" alt="' + detaiJson.specConfs[a].alias + '" putphotocls="higher"></div></div></div>') : o += "<div data-specId=" + i.productSpecValues[e].specId + ' class="e_box e_ProductBox-001 p_Product size ' + d + '" data-id=' + i.productSpecValues[e].id + "><div data-specId=" + i.productSpecValues[e].specId + ' class="e_box e_box-000 d_articles p_articles"><div class="e_box e_box-000 d_LabelBoxA"><div class="e_title e_info-001 d_label"><div class="font"><i class="iconfont"></i>' + detaiJson.specConfs[a].alias + "</div></div></div></div></div>";
                        break
                    }
            o += "</div>"
        }), a.find(".p_products").html(o)), detaiJson && (PruductskuDetailClick(a, n, detaiJson), sizeDetailClick(a, n, detaiJson)), getPruduct(a, "", n), a.find(".productsA .product").each(function(t, i) {
            for (var e = 0; e < detaiJson.skus[0].productSkuSpecs.length; e++) i.getAttribute("data-id") == detaiJson.skus[0].productSkuSpecs[e].specValueId && a.find("[data-id=" + i.getAttribute("data-id") + "]").click()
        }), i && 0 < i.length && "true" != n.product && disabledBtn(".p_Buy .btn,.p_AddCart .btn", a)
    }

    function getPruduct(t, i, e) {
        var a = [];
        t.find(".text").hide(), t.find(".p_products .active").each(function(t, i) {
            a.push(i.getAttribute("data-id"))
        });
        var s = 0;
        if (detaiJson && detaiJson.skus)
            for (var n = 0; n < detaiJson.skus.length; n++) {
                if (s == a.length) {
                    "1" == detaiJson.skus[n].isDefault && (e.skuId = detaiJson.skus[n].id);
                    break
                }
                for (var o = s = 0; o < detaiJson.skus[n].productSkuSpecs.length; o++) {
                    for (var d = 0; d < a.length; d++)
                        if (a[d] == detaiJson.skus[n].productSkuSpecs[o].specValueId) {
                            s++;
                            break
                        }
                    if (s == a.length) {
                        t.find(".d_SalePrice").html('<i class="iconfont"></i>' + Number(detaiJson.skus[n].retailPrice).toFixed(2)), t.find(".d_MarketPrice .font").html('<i class="iconfont"></i>' + Number(detaiJson.skus[n].price).toFixed(2)), t.find(".d_numA").text(detaiJson.skus[n].stock ? detaiJson.skus[n].stock : 0), t.find(".d_moq").text(detaiJson.skus[n].moq), t.find("#buyNum").val(detaiJson.skus[n].moq || 1), moqNum = detaiJson.skus[n].moq, stockNum = detaiJson.skus[n].stock ? detaiJson.skus[n].stock : 0, tipMoqNum = e.moq = detaiJson.skus[n].moq || 1, tipStockNum = e.stock = detaiJson.skus[n].stock ? detaiJson.skus[n].stock : 1, e.skuId = detaiJson.skus[n].id, detaiJson.skus[n].stock <= 0 ? disabledBtn(".p_Buy .btn", t) : removeDisabled(".p_Buy .btn", t), !detaiJson.skus[n].stock || detaiJson.skus[n].stock < detaiJson.skus[n].moq ? disabledBtn(".p_AddCart .btn", t) : removeDisabled(".p_Buy .btn,.p_AddCart .btn", t);
                        break
                    }
                }
            }
        s != a.length && (i.removeClass("active"), t.find(".text").show())
    }

    function mouseFn(t, a) {
        t.find(".p_AddCart").mouseenter(function() {
            var t = $(this).find(".btn").hasClass("disabled"),
                i = a.errtips.noStock,
                e = a.errtips.smallStock1 + tipMoqNum + a.errtips.smallStock2;
            t && ($(this).find(".p_tipsBox").removeClass("hide"), tipMoqNum == tipStockNum ? $(this).find(".p_tipsBox .font").html(i) : tipStockNum < tipMoqNum && $(this).find(".p_tipsBox .font").html(e))
        }).mouseleave(function() {
            $(this).find(".p_tipsBox").addClass("hide")
        })
    }

    function PruductskuDetailClick(e, a, t) {
        var s = t.specConfs,
            n = new Array;
        e.find(".p_products .product").unbind("click").click(function() {
            $(this).addClass("active").siblings(".product").removeClass("active"), $(this).addClass("active").siblings(".size").removeClass("active");
            var i = $(this).attr("data-id");
            s.forEach(function(t) {
                t.specValueId == i && (n = t)
            }), n.productSpecImgList[0] && (oldSrc = n.productSpecImgList[0].imagePath, e.find(".zoom .p_image.visible img").attr("src", oldSrc));
            var t = setNewimgJson(e, a, n);
            a.imageJson = JSON.parse(a.imageJson), a.imageJson.navs = t, a.imageJson = JSON.stringify(a.imageJson), productImageHandle(a), getPruduct(e, $(this), a)
        })
    }
    var skuClick = function(t, i) {
        var e = t.find(".p_ColorSpec"),
            a = t.find(".p_ImgSpec");
        e.each(function() {
            $(this).on("click", function() {
                $(this).attr("data-id"), $(this).addClass("active").siblings().removeClass("active")
            })
        }), a.each(function() {
            $(this).on("click", function() {
                $(this).attr("data-id"), $(this).addClass("active").siblings().removeClass("active")
            })
        })
    };

    function sizeDetailClick(t, i, e) {
        t.find(".p_products .size").unbind("click").click(function() {
            $(this).addClass("active").siblings(".size").removeClass("active"), $(this).addClass("active").siblings(".product").removeClass("active"), getPruduct(t, $(this), i)
        })
    }

    function setNewimgJson(t, i, a) {
        var s = new Array;
        return a.productSpecImgList && 0 < a.productSpecImgList.length && a.productSpecImgList.forEach(function(t) {
            var i = t.imagePath && t.imagePath.split(".").pop() || "jpg",
                e = {
                    srcBigPic: t.imagePath,
                    bigH: 600,
                    title: a.alias,
                    imgHref: "javascript:void(0)",
                    smallH: "",
                    smallW: "",
                    path: t.imagePath + "_{i}xa." + i,
                    smallPath: t.imagePath + "_{i}xa." + i,
                    bigW: 800,
                    imgHrefType: "_parent"
                };
            s.push(e)
        }), s
    }

    function setNewVideoImgJson(t) {
        var e = $compCl.getScope(t.id);
        if (t.imageJson && "" != t.imageJson) a = "string" == typeof t.imageJson ? JSON.parse(t.imageJson) : t.imageJson;
        else var a = JSON.parse('{"navs":[]}');
        var s = e.find(".videoUrl").map(function() {
                return $(this).val()
            }).get().join(",").split(","),
            n = e.find(".videoTitle").map(function() {
                return $(this).val()
            }).get().join(",").split(","),
            o = e.find(".videoImgSrc").map(function() {
                return $(this).val()
            }).get().join(",").split(",");
        if (s && n && o && 0 < s.length && "" != s[0])
            for (i = 0; i < s.length; i++) {
                var d = {
                    bigH: "",
                    bigW: "",
                    imgHref: "javascript:void(0)",
                    imgHrefType: "_parent",
                    path: o[i],
                    smallH: "",
                    smallPath: o[i],
                    smallW: "",
                    srcBigPic: o[i],
                    title: n[i],
                    video_path: s[i]
                };
                a.navs.splice(0, 0, d)
            }
        return a
    }
    var oldSrc = null;

    function PruductskuDetailmouse(i, t) {
        i.find(".p_products .p_Product").on("mouseover", function() {
            oldSrc = i.find(".zoom .p_image.visible img").attr("src");
            var t = $(this).find(".p_image.visible img").attr("src");
            i.find(".zoom .p_image.visible img").attr("src", t)
        }).on("mouseout", function() {
            i.find(".zoom .p_image.visible img").attr("src", oldSrc), oldSrc = null
        })
    }

    function addBuySum(t, a, s, i) {
        var e = s.productId,
            n = s.skuId,
            o = s.errtips,
            d = $.trim(a.find(".d_SalePrice").text()),
            r = {};
        "true" == s.product ? r = getProInfo(n) : (r.skuName = s.proName, r.skuSpec = ""), r.skuImg || (r.skuImg = s.productCoverImgUrl);
        var c = {};
        c[n] = {
            skuId: n,
            productId: e,
            appId: s.appId,
            buyNum: t,
            buyPrice: d,
            skuName: r.skuName,
            skuSpec: r.skuSpec,
            skuImg: r.skuImg
        };
        var p = {
            appId: s.appId,
            compId: s.id,
            firstAsk: !1,
            toCartParams: JSON.stringify(c)
        };
        ajxaQueryFun(a, s, "/interactionApi/shoppingCart/addShoppingCart", p, "POST", function u(t) {
            var i = JSON.parse(t.data),
                e = JSON.parse(i.data);
            1 == e.flag ? (updatePageData(a, s.skuId, e), $.message({
                msg: o.oneTip,
                type: "success"
            })) : 2 == e.flag ? $.message({
                msg: o.twoTip,
                type: "error"
            }) : 4 == e.flag ? ($.message({
                msg: o.fourTip,
                type: "error"
            }), disabledBtn(".p_Buy .btn,.p_AddCart .btn", a)) : 0 == e.flag ? $.message({
                msg: o.zeroTip,
                type: "error"
            }) : -1 == e.flag && $.message({
                msg: o.downShopTip,
                type: "error"
            });
            setTimeout(function() {
                window.location.reload()
            })
        })
    }

    function updatePageData(t, e, a) {
        t.find(".p_shopCartNum .font").text(a.cartNum).show(), t.find(".js_stockNum").html(a.newStock), $.each(detaiJson.skus, function(t, i) {
            i.id != e || (i.stock = a.newStock)
        }), t.find("#product-skuDetail").val(JSON.stringify(detaiJson))
    }

    function getProInfo(s) {
        var n = {
            skuName: "",
            skuSpec: "",
            skuImg: ""
        };
        return $.each(detaiJson.skus, function(t, i) {
            if (i.id == s) {
                n.skuName = i.name;
                for (var e = 0; e < i.productSkuSpecs.length; e++)
                    if (e == i.productSkuSpecs.length - 1 ? n.skuSpec += i.productSkuSpecs[e].specName + ":" + i.productSkuSpecs[e].specValueName : n.skuSpec += i.productSkuSpecs[e].specName + ":" + i.productSkuSpecs[e].specValueName + " ", "" == n.skuImg)
                        for (var a = 0; a < detaiJson.specConfs.length; a++) detaiJson.specConfs[a].id == i.productSkuSpecs[e].specConfigId && 0 < detaiJson.specConfs[a].productSpecImgList.length && "" == n.skuImg && (n.skuImg = detaiJson.specConfs[a].productSpecImgList[0].imagePath);
                return !1
            }
        }), n
    }

    function disabledBtn(t, i) {
        $(t, i).addClass("disabled"), $(".js_disabled").on("click", function(t) {
            t.preventDefault()
        })
    }

    function removeDisabled(t, i) {
        $(t, i).removeClass("disabled")
    }

    function buttonClickFun(c, p, t) {
        parseInt(c.stock) ? removeDisabled(".p_Buy .btn,.p_AddCart .btn", p) : disabledBtn(".p_Buy .btn,.p_AddCart .btn", p), p.find(".p_Buy").on("click", function(t) {
            if ($(this).find(".btn").hasClass("disabled")) return !1;
            if (tipStockNum < tipMoqNum) $.message({
                type: "error",
                msg: c.errtips.smallStock1 + tipMoqNum + c.errtips.smallStock2
            });
            else {
                var i = c.aBuyHref,
                    e = c.aBuyTarget || "_self",
                    a = "";
                a = "" != i ? window.location.origin + "/" + i : window.location.origin + window.location.pathname;
                var s = p.find("#buyNum").val(),
                    n = $.trim(p.find(".d_SalePrice").eq(0).text()),
                    o = p.find(".p_products .active").attr("data-specId"),
                    d = (o = p.find(".p_products .product .p_images").attr("data-specId"), []);
                d[0] = {
                    productId: c.skuId,
                    buyNum: s,
                    buyPrice: n,
                    specId: o
                };
                var r = a + "?buyInfo=" + JSON.stringify(d);
                linkSkipFun(p, r, e)
            }
        }), p.find(".p_AddCart").on("click", function() {
            p.find(".p_AddCart .btn").hasClass("disabled") || addBuySum(p.find("#buyNum").val(), p, c, t)
        }), joinFn(p.find(".p_addInquiry"), $(".js-protalResProductEnquiry_floating_compId").val()), joinFn(p.find(".p_btnB"), $(".js-protalResProduct_floating_compId").val())
    }

    function joinFn(t, e) {
        t.unbind("click").click(function() {
            var t = e,
                i = $("#" + t);
            "none" == i.css("display") && i.show(), productFloat(t, this)
        })
    }

    function productFloat(t, i) {
        if (!isEmpty(t)) {
            var e = $(i).parent(".p_interaction").find(".js_compareFloatData"),
                a = {
                    image: e.attr("image"),
                    name: e.attr("name"),
                    id: e.attr("id"),
                    templateId: e.attr("templateId")
                };
            $compCl.getAllInitFunc()[t].add(a)
        }
    }
    var textHandle = function(t, i) {
            i.isCutOfName && $(".d_title", t).fixLineN(i.linesOfCutOfName), i.isCutOfSummary && $(".d_summary", t).fixLineN(i.linesOfCutOfSummary), i.productSummary && $(".d_description", t).fixLineN(i.productSummaryMaxLen)
        },
        toBl = function(t, i) {
            t.find(".d_SalePrice .font,.d_MarketPrice .font").each(function() {
                var t = Number($(this).text()).toFixed(2);
                $(this).text(t)
            })
        };

    function getViewCount(e, t) {
        if (e.find(".p_ViewBox").length <= 0) return !1;
        var i = parseInt(e.find(".p_ViewBox").attr("data-infoid")),
            a = 2;
        123 == parseInt(t.appId) && (a = 49), 124 == parseInt(t.appId) && (a = 50);
        var s = {
            id: i,
            appTag: a || 2
        };
        $.ajax({
            type: "GET",
            url: "/commentViewCount/ajax/updateAndGetViewCount",
            data: s,
            async: !1,
            success: function(t) {
                var i = JSON.parse(t);
                i && 200 == i.status && e.find(".p_view .font").html(i.data)
            }
        })
    }

    function shopCartOption(a, t, i) {
        if (i.firstAsk) {
            var e = {
                appId: t.appId,
                toCartParams: {},
                firstAsk: i.firstAsk
            };
            ajxaQueryFun(a, t, "/interactionApi/shoppingCart/addShoppingCart", e, "POST", function(t) {
                var i = JSON.parse(t.data),
                    e = JSON.parse(i.data);
                "3" == e.flag && a.find(".p_shopCartNum .font").text(e.cartNum).show()
            })
        }
    }
    var init = function(s) {
        s = this._params;
        var a = $compCl.getScope(s.id),
            t = this._params.imageJson;
        s.productID;
        buttonClickFun(s, a, t), a.find("img").onErrorImg(), r.lazyImg({
            defObj: "#" + a.attr("id")
        }), $.mediaQuery({
            callback1024: function() {},
            callback7681024: function() {},
            callback768: function() {}
        }), shopCartOption(a, s, {
            firstAsk: !0
        }), productImageHandle(s), setTab(s, a), toBl(a, s), mouseFn(a, s), PruductskuDetail(a, s), a.find("#contentPage").click(function() {
            $(this).addClass("active"), a.find("#paramPage").removeClass("active"), a.find("#contentDiv").removeClass("hide"), a.find("#paramDiv").addClass("hide"), a.find("#moreTextDiv").addClass("hide"), a.find("#commentDiv").addClass("hide"), a.find(".TabHead").removeClass("active"), a.find(".TabCont").addClass("hide"), setPosition()
        }), a.find("#paramPage").click(function() {
            $(this).addClass("active"), a.find("#contentPage").removeClass("active"), a.find("#paramDiv").removeClass("hide"), a.find("#contentDiv").addClass("hide"), a.find("#moreTextDiv").addClass("hide"), a.find("#commentDiv").addClass("hide"), a.find(".TabHead").removeClass("active"), a.find(".TabCont").addClass("hide"), setPosition()
        }), a.find(".TabHead").each(function(t, i) {
            $(i).on("click", function() {
                $(this).addClass("active").siblings(".TabHead").removeClass("active"), a.find(".TabCont").eq(t).removeClass("hide").siblings(".TabCont").addClass("hide"), a.find("#paramPage").removeClass("active"), a.find("#contentPage").removeClass("active"), a.find("#paramDiv").addClass("hide"), a.find("#contentDiv").addClass("hide"), setPosition()
            })
        }), a.find("#moreTextPage").click(function() {
            a.find("#moreTextDiv").removeClass("hide"), a.find("#contentDiv").addClass("hide"), a.find("#paramDiv").addClass("hide"), a.find("#commentDiv").addClass("hide")
        }), a.find("#commentPage").click(function() {
            a.find("#commentDiv").removeClass("hide"), a.find("#contentDiv").addClass("hide"), a.find("#paramDiv").addClass("hide"), a.find("#moreTextDiv").addClass("hide")
        }), a.find(".p_dcy").click(function() {
            var t = $(this).data("url");
            if ("" != t) {
                var i = t.match(/(http|https):\/\//);
                window.location = i ? t : $.getProtocol() + t
            }
        }), a.find(".d_plus").on("click", function() {
            var t = a.find(".d_input").val() || 0;
            parseInt(t) < parseInt(s.stock) && t++, a.find(".d_input").val(t)
        }), a.find(".d_minus").on("click", function() {
            var t = a.find(".d_input").val();
            parseInt(t) > s.moq && t--, a.find(".d_input").val(t)
        }), a.find(".d_input").on("input", function() {
            /^[0-9]*$/.test(a.find("#buyNum").val()) || ($.message({
                msg: s.numberErrorTip,
                type: "error"
            }), a.find("#buyNum").val(moqNum || "0")), (parseInt(a.find("#buyNum").val()) > parseInt(stockNum || s.stock) || parseInt(a.find("#buyNum").val()) < moqNum) && ($.message({
                msg: s.numberErrorTip,
                type: "error"
            }), a.find("#buyNum").val(moqNum || "0"))
        });
        var e = s.pMode,
            n = s.rpType,
            o = s.ptype;
        "1" == n && "1" == o && ("true" == e ? a.find(".js_price").remove() : a.find(".js_price").addClass("item_hide"));
        var d = s.numType;
        "1" == n && "1" == o && "true" == d && ("true" == e ? a.find(".js_num").remove() : a.find(".js_num").addClass("item_hide"));
        var c = s.attrOneSize,
            p = s.attrOneStatus;
        "0" == c || "false" == p ? "true" == e ? a.find(".js_attrOne").remove() : a.find(".js_attrOne").addClass("item_hide") : a.find("#contentPage").removeClass("item_hide");
        s.attrMoreSize, s.attrMoreStatus, s.pContentSize, s.pContentStatus;
        a.find(".d_DecTab").hasClass("item_hide") && (a.find(".p_SpecBoxContA").removeClass("hide"), a.find(".d_SpecTab").addClass("active")), a.find(".p_ShareBox,.p_CommentBox,.p_FavoriteBox").each(function() {
            var t = $.grep($(this).attr("class").split(" "), function(t, i) {
                    return t && -1 != t.indexOf("p_")
                })[0].split("p_")[1],
                i = {
                    appId: s.appId,
                    id: s.productID
                },
                e = 0;
            "ShareBox" == t ? i.f = s.shareRule : "CommentBox" == t ? (i.f = s.commentARule, e = function a(t, i) {
                var e = {
                    format: 0,
                    data: 0
                };
                return $.ajax({
                    type: "POST",
                    url: t,
                    data: i,
                    async: !1,
                    success: function(t) {
                        e = $.parseJSON(t)
                    }
                }), e.format ? e.format : 0
            }("/message/ajax/num.do", i)) : "FavoriteBox" == t && (i.f = s.favoriteRule), $(this).find("div:last-child .font").html("<i class='iconfont'></i>" + e)
        });
        var u = commonShortUrl + s.c_qrcode,
            l = s.qrcodeWidth || 255,
            m = s.qrcodeHeight || 255;
        a.find(".js_qrcode").qrcode({
            width: l,
            height: m,
            render: "canvas",
            text: u
        });
        var _ = s.qrbuyUrl,
            f = s.qrbuyUrlWidth,
            g = s.qrbuyUrlHeight;
        a.find(".js_qrbuyUrl").qrcode({
            width: f,
            height: g,
            render: "canvas",
            text: _
        });
        var v = JSON.parse(s.img360Arr || "[]"),
            h = v.map(function(t) {
                return t.url.substring(17, 39)
            }),
            k = h.length,
            b = v[0] && v[0].wide,
            C = v[0] && v[0].height;
        0 < $(".p_show360").length && (! function y() {
            new keyshotVR("KeyShotVR", "repository/image", b, C, "#FFFFFF", k, 1, !0, !1, -.066667, 1, k - 1, 0, 1, 1, .96, !0, !1, !1, "jpg", !0, "ks_logo.png", !0, h)
        }(), ShotVRBtn(a)), textHandle(a, s.textParams), skuClick(a, s), a.find(".d_downloadBox").each(function(t, i) {
            var e = JSON.parse("[" + a.find(".ProdownloadId").eq(t).attr("value") + "]");
            $(this).html(function s(t, i) {
                for (var e = "", a = 0; a < i.length; a++) e += "<li id=" + i[a].id + " data-sign=" + i[a].sign + '><i class="iconfont"><span>' + i[a].fileName + "</span></i></li>";
                return e
            }(0, e))
        }), a.find(".itembox").on("click", "li", function() {
            var t = $(this).attr("id"),
                i = $(this).attr("data-sign");
            i == undefined || "" == i ? $.fileDownload("/comp/file/download.do?id=" + t) : $.fileDownload("/comp/file/download.do?id=" + t + "&sign=" + i)
        }), getViewCount(a, s), r.lazyImg(), $(function() {
            setTimeout(function() {
                var t;
                if (s.imageJson && "" != s.imageJson)
                    for (t = "string" == typeof s.imageJson ? JSON.parse(s.imageJson) : s.imageJson, i = 0; i < t.navs.length; i++) {
                        var e = t.navs[i].title,
                            a = t.navs[i].srcBigPic;
                        $("#c_" + s.id + " .p_images .zoom").each(function() {
                            var t = $(this).find(".p_image").find("img"),
                                i = t.attr("title");
                            e == i && ("/" == a.substr(0, 1) ? t.attr("src", a) : t.attr("src", "/" + a))
                        })
                    }
            }, 1e3), $("#c_" + s.id + " .j-nav").click(function() {
                var t = $(this).index(),
                    i = $("#c_" + s.id + " .p_images .zoom").eq(t).attr("imghref");
                "/" == i.substr(0, 1) ? $("#c_" + s.id + " .p_images .zoom").eq(t).find("img").attr("src", i) : $("#c_" + s.id + " .p_images .zoom").eq(t).find("img").attr("src", "/" + i)
            })
        })
    };
    return {
        init: init
    }
});