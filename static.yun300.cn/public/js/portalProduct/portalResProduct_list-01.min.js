$define(["wgt_util", "wgt_readyload", "jquery.adFocus", "jquery.mediaQuery", "md5", "jquery.confirm", "jquery.message", "jquery.fileDownload"], function(e, f, n, t, r, a, s, o, i) {
    var g = function(e, t, r, a, s, n) {
            var o = {};
            o.request_url = r, o.url_param = a, o.requst_type = s, "true" == t.isMock && (o.url_param.isMock = "true");
            var i = encodeURIComponent(encodeURIComponent(JSON.stringify(o))),
                u = f.md5Sign(JSON.stringify(o));
            f.ajax({
                type: "POST",
                url: "/comp/portalRouter",
                data: {
                    sign: u,
                    param: i
                },
                async: !1,
                success: function(e) {
                    n(e)
                },
                error: function() {}
            })
        },
        u = function(e, t) {
            var r, a, s, n = t.defaultImage,
                o = t.definedDefaultImage;
            r = e, s = n, 1 == (a = o) || "true" == a ? f(".p_images img", r).onErrorImg(s) : f(".p_images img", r).onErrorImg();
            var i = 2;
            if (t.isOpenCutMode && (i = 1), t.isRate) {
                var u = t.widthOfRate / t.heightOfRate;
                f(".p_image", e).putPhotoDiv(i, u)
            } else f(".p_image", e).putPhotoDiv(i)
        };

    function c(e) {
        var t = new RegExp("(^|&)" + e + "=([^&]*)(&|$)", "i"),
            r = window.location.search.substr(1).match(t);
        return null != r ? unescape(r[2]) : null
    }

    function p(e, t) {
        var r;
        return f.ajax({
            type: "POST",
            url: e,
            data: t,
            async: !1,
            success: function(e) {
                r = e
            }
        }), r
    }

    function m(e) {
        return "/comp/portalResProduct/list.do?compId=" + e
    }

    function d(e, r) {
        setTimeout(function() {
            ! function t(e, a) {
                e.find(".p_imagesPc").each(function(e) {
                    var t = jQuery.extend(!0, {}, a),
                        r = f(this).attr("imgData");
                    f(this).removeAttr("imgData"), r && (t.data = JSON.parse(r), f(this).adFocus(t), f(this).find("img").attr("src") || f(this).find("img").attr("src", "/public/img/no-img.svg")), f(this).find(".p_linkB").attr("href", f(this).data("url")), f(this).find(".p_linkB").attr("target", f(this).data("target"))
                })
            }(r, e.imageOpts)
        }, 200)
    }

    function l(e, t) {
        if (! function s(e) {
                return e == undefined || null == e || 0 == e.length
            }(e)) {
            var r = f(t).parent(".p_interaction").find(".js_compareFloatData"),
                a = {
                    image: r.attr("image"),
                    name: r.attr("name"),
                    id: r.attr("id"),
                    templateId: r.attr("templateId")
                };
            $compCl.getAllInitFunc()[e].add(a), n.lazyImg()
        }
    }

    function P(s) {
        var n = {
            skuName: "",
            skuSpec: "",
            skuImg: "",
            skuId: ""
        };
        return n.specId = undefined, n.minBuyNum = 1, f.each(s.skus, function(e, t) {
            if (t.productSkuSpecs && (n.specId = "2", n.minBuyNum = t.moq), "1" == t.isDefault) {
                n.skuId = t.id, n.skuName = t.name;
                for (var r = 0; r < t.productSkuSpecs.length; r++)
                    if (r == t.productSkuSpecs.length - 1 ? n.skuSpec += t.productSkuSpecs[r].specName + ":" + t.productSkuSpecs[r].specValueName : n.skuSpec += t.productSkuSpecs[r].specName + ":" + t.productSkuSpecs[r].specValueName + " ", "" == n.skuImg)
                        for (var a = 0; a < s.specConfs.length; a++) s.specConfs[a].id == t.productSkuSpecs[r].specConfigId && s.specConfs[a].productSpecImgList && 0 < s.specConfs[a].productSpecImgList.length && "" == n.skuImg && (n.skuImg = s.specConfs[a].productSpecImgList[0].imagePath);
                return !1
            }
        }), n
    }

    function y(c, t) {
        t.find(".p_addCart").unbind("click").click(function() {
            var e = f(this).siblings(".js_compareFloatData");
            ! function l(e, t, r) {
                var a, s = r.attr("id"),
                    n = r.attr("price"),
                    o = JSON.parse(r.attr("skuSpec")),
                    i = e.errtips,
                    u = {},
                    c = (u = P(o)).skuId;
                a = u.minBuyNum, u.skuImg || (u.skuImg = r.attr("image"));
                var d = {};
                d[c] = {
                    skuId: c,
                    productId: s,
                    appId: e.appId,
                    buyNum: a,
                    buyPrice: n,
                    skuName: u.skuName,
                    skuSpec: u.skuSpec,
                    skuImg: u.skuImg
                };
                var p = {
                    appId: e.appId,
                    compId: e.id,
                    firstAsk: !1,
                    toCartParams: JSON.stringify(d)
                };
                g(t, e, "/interactionApi/shoppingCart/addShoppingCart", p, "POST", function m(e) {
                    var t = JSON.parse(e.data),
                        r = JSON.parse(t.data);
                    1 == r.flag ? f.message({
                        msg: i.oneTip,
                        type: "success"
                    }) : 2 == r.flag ? f.message({
                        msg: i.twoTip,
                        type: "error"
                    }) : 4 == r.flag ? f.message({
                        msg: i.fourTip,
                        type: "error"
                    }) : 0 == r.flag ? f.message({
                        msg: i.zeroTip,
                        type: "error"
                    }) : -1 == r.flag && f.message({
                        msg: i.downShopTip,
                        type: "error"
                    }), setTimeout(function() {
                        window.location.reload()
                    })
                })
            }(c, t, e)
        }), t.find(".mouseBtn").mouseenter(function() {
            f(this).find(".p_tipsBox").removeClass("hide")
        }).mouseleave(function() {
            f(this).find(".p_tipsBox").addClass("hide")
        }), t.find(".p_purchase").unbind("click").click(function() {
            var e = c.aBuyHref,
                t = c.aBuyTarget || "_self",
                r = "";
            r = "" != e ? window.location.origin + "/" + e : window.location.origin + window.location.pathname;
            var a = f.trim(f(this).siblings(".js_compareFloatData").attr("price")),
                s = JSON.parse(f(this).siblings(".js_compareFloatData").attr("skuSpec")),
                n = P(s).skuId,
                o = P(s).minBuyNum,
                i = [];
            i[0] = {
                    productId: n,
                    buyNum: o,
                    buyPrice: a,
                    specId: P(s).specId
                },
                function u(e, t, r) {
                    "_blank" == r ? f.openNewWindow(t) : f.openHref(t), f._UTL.stopEvent(event)
                }(0, r + "?buyInfo=" + JSON.stringify(i), t)
        }), t.find(".p_addInquiry").unbind("click").click(function() {
            var e = f(".js-protalResProductEnquiry_floating_compId"),
                r = f(this);
            e.each(function() {
                var e = f(this).val(),
                    t = f("#" + e);
                "none" == t.css("display") && t.show(), l(e, r)
            })
        }), t.find(".p_btnB").unbind("click").click(function() {
            var e = f(".js-protalResProduct_floating_compId").val(),
                t = f("#" + e);
            "none" == t.css("display") && t.show(), l(e, this)
        })
    }
    return {
        init: function() {
            var t = this._params,
                e = $compCl.getScope(t.id);
            f(".p_priceUnit.iconfont", e).hasClass("js-retailPriceUnit") && f(".p_priceUnit.iconfont", e).html() || ("zh_CN" !== window.tenant.language ? f(".p_priceUnit.iconfont", e).html("&#xe736;") : f(".p_priceUnit.iconfont", e).html("&#xe6d7;")), f(".p_priceUnit.iconfont", e).append("<style>." + t.styleId + " .p_priceUnit::before{display:none}</style>"), e.find(".p_sort").createProductSort(function s(c, d) {
                d = $compCl.getScope(c.id);
                var e = c.requestParam.orderColumn || "def",
                    t = !0;
                c.requestParam.orderType && "0" == c.requestParam.orderType && (t = !1);
                var r = {
                        key: e,
                        downArraw: t
                    },
                    a = {
                        click: function(e, t, r, a) {
                            if ("def" == r.key) {
                                t.attr("lang", "active");
                                var s = t.siblings();
                                f.resetOtherSort(s, a), c.requestParam.orderColumn = r.key, c.requestParam.orderType = "0"
                            } else {
                                f.triggerProductSort(t, r, a);
                                var n = t.data("productCount");
                                c.requestParam.orderColumn = r.key, c.requestParam.orderType = n
                            }
                            var o = "";
                            if (c.requestParam.screenFlag = c.requestParam.screenflag || "false", o = "true" == c.requestParam.screenFlag ? m(c.id) + "&cache=false" : m(c.id), 768 == f.mediaQuery({
                                    node: !0
                                })) {
                                var i = f(".p_pagebox .click", d).attr("currentpage");
                                c.requestParam.currentPage = i;
                                var u = p(o, c.requestParam);
                                d.html(u)
                            } else 7681024 != f.mediaQuery({
                                node: !0
                            }) && 1024 != f.mediaQuery({
                                node: !0
                            }) || (i = f(".pageNum.active", d).html(), c.requestParam.currentPage = i, u = p(o, c.requestParam), d.html(u))
                        }
                    };
                return {
                    item: [{
                        show: !0,
                        type: "sort",
                        key: "def",
                        v: c.sortParams.DEFAULT_SORT.v,
                        title: c.sortParams.DEFAULT_SORT.title,
                        downArraw: !0,
                        action: a
                    }, {
                        show: c.sortParams.PUBLISH_TIME.show,
                        type: "sort",
                        key: "PUBLISH_TIME",
                        v: c.sortParams.PUBLISH_TIME.v,
                        title: c.sortParams.PUBLISH_TIME.title,
                        downArraw: !0,
                        action: a
                    }, {
                        show: c.sortParams.PRODUCT_NAME.show,
                        type: "sort",
                        key: "PRODUCT_NAME",
                        v: c.sortParams.PRODUCT_NAME.v,
                        title: c.sortParams.PRODUCT_NAME.title,
                        downArraw: !1,
                        action: a
                    }, {
                        show: c.sortParams.PVS.show,
                        type: "sort",
                        key: "PVS",
                        v: c.sortParams.PVS.v,
                        title: c.sortParams.PVS.title,
                        downArraw: !0,
                        action: a
                    }, {
                        show: c.sortParams.comment.show,
                        type: "sort",
                        key: "comment",
                        v: c.sortParams.comment.v,
                        title: c.sortParams.comment.title,
                        downArraw: !0,
                        action: a
                    }, {
                        show: c.sortParams.PRODUCT_CODE.show,
                        type: "sort",
                        key: "PRODUCT_CODE",
                        v: c.sortParams.PRODUCT_CODE.v,
                        title: c.sortParams.PRODUCT_CODE.title,
                        downArraw: !1,
                        action: a
                    }],
                    elements: {
                        def: {
                            style: c.sortParams.DEFAULT_SORT.style,
                            zstyle: "p_default",
                            tstyle: ""
                        },
                        PUBLISH_TIME: {
                            style: c.sortParams.PUBLISH_TIME.style,
                            zstyle: "p_TimeSort",
                            tstyle: "i_TimeSort"
                        },
                        PRODUCT_NAME: {
                            style: c.sortParams.PRODUCT_NAME.style,
                            zstyle: "p_NameSort",
                            tstyle: "i_NameSort"
                        },
                        PVS: {
                            style: c.sortParams.PVS.style,
                            zstyle: "p_ViewSort",
                            tstyle: "i_ViewSort"
                        },
                        comment: {
                            style: c.sortParams.comment.style,
                            zstyle: "p_CommentSort",
                            tstyle: "i_CommentSort"
                        },
                        PRODUCT_CODE: {
                            style: c.sortParams.PRODUCT_CODE.style,
                            zstyle: "p_NoSort",
                            tstyle: "i_NoSort"
                        }
                    },
                    defVal: r
                }
            }(t, e)).init(), f("div.p_products").addClass("p_productsSet");
            var r, a;
            t.requestParam.orderType || (t.requestParam.orderType = "0"), t.requestParam.orderColumn || (t.requestParam.orderColumn = "def"), e.find(".js-dropdown").click(function(e) {
                e.stopPropagation(), f(this).parents(".p_Product").siblings().find(".dropdown-toggle").siblings(".dropdown-menu").css("display", "none"), f(this).siblings(".dropdown-menu").css("display"), f(this).siblings(".dropdown-menu").toggle()
            }), f(document).click(function() {
                e.find(".dropdown-menu").hide()
            }), isFrontEnv() && f(window).resize(function() {
                f.mediaQuery({
                    callback1024: function() {},
                    callback7681024: function() {
                        location.reload()
                    },
                    callback768: function() {},
                    firstLoad: !1
                })
            }), 768 == f.mediaQuery({
                node: !0
            }) ? (function n() {
                f(".p_OccupyBox .p_page").hide(), 0 < f(".p_OccupyBox .p_pagebox").length ? f(".p_OccupyBox .p_pagebox").show() : ("turnPage" == t.pageParam.turnPageType && f(".p_products", e).removeAttr("isServerPaging"), function o(e, t) {
                    var r = t.pageParam.url + "&orderType=" + t.requestParam.orderType + "&orderColumn=" + t.requestParam.orderColumn + "&" + t.requestParam.appType + "=" + t.requestParam.productCateId,
                        a = {
                            url: "true" == t.requestParam.screenflag ? r + "&cache=false" : r
                        };
                    if (t.requestParam.screenflag != undefined && t.requestParam.screenItemStr != undefined && t.requestParam.screenGroupId != undefined) {
                        a.data = t.requestParam, a.data.screenFlag = t.requestParam.screenflag;
                        var s = f.getUrlId();
                        if (s && !isNaN(s)) a.data.productCateId = s;
                        else {
                            var n = c("productCateId");
                            n && !isNaN(n) && (a.data.productCateId = s)
                        }
                    }
                    a.firstRefresh = !1, t.requestParam.screenType != undefined && t.requestParam.screenItemStr != undefined && (a.data = t.requestParam, a.data.screenType = t.requestParam.screenType, a.data.screenItemStr = t.requestParam.screenItemStr), f(".p_products", e).resPaging(a)
                }(e, t))
            }(), e.find(".js_down").off("click"), e.find(".js_down").on("click", function(e) {
                e.stopPropagation(),
                    function r(e) {
                        var t = document.createElement("iframe");
                        t.src = e, t.style.display = "none", document.body.appendChild(t)
                    }("/comp/xcompanyFile/download.do?fid=" + f(this).attr("data-fileId") + "&appId=" + t.appId + "&id=" + f(this).attr("data-comId"))
            })) : 7681024 != f.mediaQuery({
                node: !0
            }) && 1024 != f.mediaQuery({
                node: !0
            }) || (function i() {
                d(t, e), f(".p_OccupyBox .p_pagebox").hide(), 0 < f(".p_OccupyBox .p_page").length && f(".p_OccupyBox .p_page").show(), "turnPage" == t.pageParam.turnPageType && f(".p_products", e).removeAttr("isServerPaging"),
                    function o(e, t) {
                        var r = t.pageParam.url + "&orderType=" + t.requestParam.orderType + "&orderColumn=" + t.requestParam.orderColumn + "&" + t.requestParam.appType + "=" + t.requestParam.productCateId,
                            a = {
                                url: "true" == t.requestParam.screenflag ? r + "&cache=false" : r,
                                appId: t.pageParam.appId,
                                successFun: function(e) {}
                            };
                        if (t.requestParam.screenflag != undefined && t.requestParam.screenItemStr != undefined && t.requestParam.screenGroupId != undefined) {
                            a.requestParam = t.requestParam, a.requestParam.screenFlag = t.requestParam.screenflag;
                            var s = f.getUrlId();
                            if (s && !isNaN(s)) a.requestParam.productCateId = s;
                            else {
                                var n = c("productCateId");
                                n && !isNaN(n) && (a.requestParam.productCateId = n)
                            }
                        }
                        t.requestParam.screenType != undefined && t.requestParam.screenItemStr != undefined && (a.requestParam = t.requestParam, a.requestParam.screenType = t.requestParam.screenType, a.requestParam.screenItemStr = t.requestParam.screenItemStr), f(".p_products", e).resPaging(a)
                    }(e, t)
            }(), e.find(".js_down").off("click"), e.find(".js_down").on("click", function(e) {
                e.stopPropagation(),
                    function n(r, a, s) {
                        f.fileDownload("/comp/xcompanyFile/download.do?fid=" + r + "&appId=" + a + "&id=" + s, {
                            successCallback: function(e) {},
                            failCallback: function(e, t) {
                                setTimeout(function() {
                                    n(r, a, s)
                                }, 1e3)
                            }
                        })
                    }(f(this).attr("data-fileId"), t.appId, f(this).attr("data-comId"))
            })), u(e, t.picParams), y(t, e), r = e, (a = t.textParams).isCutOfName && f(".d_title", r).fixLineN(a.linesOfCutOfName), a.isCutOfSummary && f(".d_summary", r).fixLineN(a.linesOfCutOfSummary), a.categorySummary && f(".p_categorySummary", r).fixLineN(a.categorySummaryMaxLen)
        }
    }
});