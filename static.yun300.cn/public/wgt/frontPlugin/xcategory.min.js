$define(["wgt_readyload", "tmpl"], function(u, f) {
    u.fn.initCategory = function(i, s) {
        var e = $compCl.getScope(i.compId);
        n(i, e), a(i, e, s), u(".js_clickbtn").on("click", function() {
            u(this).hasClass("icon-arrow_up") && (u(this).parent().parent().find(".js_clickbtn").addClass("icon-arrow_up").removeClass("icon-arrow_down"), u(this).parent().parent().find(".p_childBox").addClass("hide"))
        })
    };
    var n = function(i, l) {
            var s = i.data,
                d = i.params,
                e = d.boxClass,
                n = u("." + e, l),
                o = d.tmplId,
                t = d.targetType,
                c = 0;
            var a = function h(i) {
                var s = /(http|https):\/\/([\w.]+\/?)\S*/;
                c++;
                for (var e = 0; e < i.length; e++) i[e].subColumn && (i[e].children = i[e].subColumn), i[e].childrenList && (i[e].children = i[e].childrenList), i[e].children && i[e].children.length || (i[e].parent = !1), i[e].image && "/" != i[e].image.substr(0, 1) && 0 == s.test(i[e].image) && (i[e].image = "/" + i[e].image), !0 !== i[e][t] && "true" !== i[e][t] && "_blank" != i[e][t] && "2" != i[e][t] || (i[e].setTarget = !0), i[e].level = c;
                for (var n = u("#" + o, l).tmpl(i), a = 0; a < i.length; a++) {
                    var r;
                    i[a].subColumn && (i[a].children = i[a].subColumn), i[a].childrenList && (i[a].children = i[a].childrenList), i[a].children && i[a].children.length && (r = h(i[a].children), n.eq(a).find("." + d.childBox).html(r))
                }
                return n
            }(s);
            n.html(a)
        },
        a = function(i, s, e) {
            var n = e || u.getUrlId(),
                a = i.params,
                r = a.isOpen,
                l = a.isReject,
                d = a.isSideOut,
                o = a.boxClass,
                t = u("." + o, s),
                c = a.clickBtn,
                h = u("." + a.clickBtn, t),
                C = a.parentBox,
                p = (u("." + a.parentBox, t), a.childBox),
                v = u("." + a.childBox, t),
                m = a.linkBox;
            u("." + a.linkBox, m);
            r ? (v.removeClass("hide"), d || h.removeClass("icon-arrow_up").addClass("icon-arrow_down")) : (v.addClass("hide"), d || h.removeClass("icon-arrow_down").addClass("icon-arrow_up")), !d && n && (u(s).find("." + C + "[sortid='" + n + "']").parents("." + p).removeClass("hide").prevAll("." + m).children("." + c).removeClass("icon-arrow_up").addClass("icon-arrow_down"), u(s).find("." + C + "[sortid='" + n + "']").children("." + m).addClass("click")), d && !r ? (t.find("." + a.parentBox).each(function(i, s) {
                var e = localStorage.getItem("navChildKey"),
                    n = localStorage.getItem("navParentId");
                e && "child" != e && e == u(this).attr("sortid") ? (u(this).find(".p_childBox:first").prev().addClass("click"), u(this).parents(".p_parentBox").each(function() {
                    u(this).find(".p_childBox:first").prev().addClass("click")
                })) : n == u(this).attr("sortid") && u(this).find(".p_childBox:first").prev().addClass("click")
            }), t.find("." + a.parentBox).on("mouseleave", function() {
                u(this).find("." + p).removeClass("slideOut").addClass("hide")
            }), t.find(".e_link").on("mouseover", function() {
                var i = u(this);
                if (l) {
                    i.closest("." + C).siblings("." + C).children("." + p).addClass("hide").removeClass("slideOut");
                    var s = i.parents("." + C)[i.parents("." + C).length - 1];
                    u(s).siblings("." + C).children("." + p).addClass("hide").siblings("div").children("." + c).removeClass("slideOut")
                }
                0 < i.closest("." + C).children("." + p).find("." + C).length && (i.siblings("div").addClass("slideOut"), i.closest("." + C).children("." + p).removeClass("hide")), f.lazyImg()
            })) : h.on("click", function() {
                var i = u(this);
                if (l) {
                    i.closest("." + C).siblings("." + C).children("." + p).addClass("hide").siblings("div").children("." + c).removeClass("icon-arrow_down").addClass("icon-arrow_up");
                    var s = i.parents("." + C)[i.parents("." + C).length - 1];
                    u(s).siblings("." + C).children("." + p).addClass("hide").siblings("div").children("." + c).removeClass("icon-arrow_down").addClass("icon-arrow_up")
                }
                i.hasClass("icon-arrow_down") ? (i.removeClass("icon-arrow_down").addClass("icon-arrow_up"), i.closest("." + C).children("." + p).addClass("hide")) : (i.removeClass("icon-arrow_up").addClass("icon-arrow_down"), i.closest("." + C).children("." + p).removeClass("hide")), f.lazyImg(), f.setCompPostion()
            })
        };
    return u
});